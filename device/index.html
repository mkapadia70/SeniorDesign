<!DOCTYPE html>
<html lang="en">
<head>
    <title>Windows Volume Mixer Controller</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <style>
        html {
            height: 100%;
            overflow:scroll;
        }
        ::-webkit-scrollbar {
            width:0px;
            background:transparent; /* make scrollbar transparent */
        }
        .horizontal-scrollable > .row {
            width:70vw;
            padding-top:5vh;
            margin:0px auto;
            overflow-x:auto;
            white-space:nowrap;
        }
        .horizontal-scrollable > .row h3{
            white-space:normal;
        }

        .horizontal-scrollable > .row > .col-xs-3 {
            display:inline-block;
            float:none;
            vertical-align:top;
        }

        .slider {
            -webkit-appearance:none;
            width:50vh!important;
            height:60px;
            margin:25vh -25vh;
            background:#d3d3d3;
            outline:none;
            transform:rotate(-90deg);
            display:inline-block!important;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance:none;
            appearance:none;
            width:30px;
            height:70px;
            background:#4CAF50;
            cursor:pointer;
        }

        .slider::-moz-range-thumb {
            width:25px;
            height:25px;
            background:#4CAF50;
            cursor:pointer;
        }
    </style>
</head>

<body style="background-color:#252525; color:white" onload="myOnload()" >
    <button class="button buttonRed" id="muteUnmute">Mute</button>
    <div class="container-fluid">
        <h1 class="text-center">Windows Volume Mixer Controller</h1>
        <div class="container-fluid horizontal-scrollable">
            <div class="row text-center" id="sliderContainer">
                <div class="col-xs-3">
                    <input id="masterVolume" type="range" min="0" max="100" class="slider">
                    <h3 class="text-center" id="testslider1name">Master</h3>
                    <input type="checkbox" id="muteUnmuteApp">
                    <label for="muteUnmuteApp" class="unmute">
                        <img src="../device/images/mute.png" title="Mute icon" width="20%" height="20%">
                    </label>
                    <label for="muteUnmuteApp" class="mute">
                        <img src="../device/images/speaker.png" title="Speaker icon" width="20%" height="20%">
                    </label>
                </div>
            </div>
        </div>
    </div>
    <script>
        var pressed = false
        //changes color and text of button
        function muteUnmute() {
        if(!pressed)
            {
                document.getElementById("muteUnmute").innerHTML = "Unmute"
                document.getElementById("muteUnmute").style.backgroundColor = "green";
                document.getElementById("muteUnmute").style.color = "white";
            }
            else
            {
                document.getElementById("muteUnmute").innerHTML = "Mute"
                document.getElementById("muteUnmute").style.backgroundColor = "red";
                document.getElementById("muteUnmute").style.color = "white";
            }
        }
        //mute/unmute button
        $(function() {
            $('#muteUnmute').bind('click', function() {
                $.getJSON("http://127.0.0.1:5001" + '/data', {
                    Name: "WindowsVolumeMixerControl",
                    Func: (pressed ? "unmuteMasterVolume" : "muteMasterVolume"),
                    Params: 0,
                    ProcessId: -1 //whatever 
                }, function(data) {
                    muteUnmute()
                    pressed = !pressed
                });
                return false;
            });
        });
        //master volume
        $(function() {
            //binds the master volume slider
            $('#masterVolume').bind('input', function() {
                $.getJSON("http://127.0.0.1:5001" + '/data', {
                    Name: "WindowsVolumeMixerControl",
                    Func: "setMasterVolume",
                    Params: document.getElementById("masterVolume").value/100.0,
                    ProcessId: -1 //whatever 
                }, function(data) {
                });
                return false;
            });
        });

        function myOnload() {
            //requests program data from python which requests it from windows
            $.getJSON("http://127.0.0.1:5001" + '/data2', {
                }, function(data) {
                    data.forEach(changeSliderData)
                });
        }
        
        function changeSliderData(value, index){
            
            //This function add the relative sliders for the data to the html
            //also binds the sliders to send back updates on volume to windows
            outerdiv = document.createElement("div")
            outerdiv.className = "col-xs-3"

            input = document.createElement("input")
            input.type = "range"
            input.min = "0"
            input.max = "100"
            input.className = "slider"
            input.value = value.currentVolume*100
            input.id = index

            h3 = document.createElement("h3")
            h3.className = "text-center"
            h3.innerHTML = value.name

            input_checkbox = document.createElement("input")
            input_checkbox.type = "checkbox"
            input_checkbox.id = "muteUnmuteApp" + index
            input_checkbox.style.display = "none"

            label_unmute = document.createElement("label")
            label_unmute.htmlFor = input_checkbox.id
            label_unmute.className = "unmute"

            img_mute = document.createElement("img")
            img_mute.src = "../device/images/mute.png"
            img_mute.title = "Mute icon"
            img_mute.style.width = "20%"
            img_mute.style.height = "20%"
            img_mute.style.display = "none"

            label_mute = document.createElement("label")
            label_mute.htmlFor = input_checkbox.id
            label_mute.className = "mute"

            img_speaker = document.createElement("img")
            img_speaker.src = "../device/images/speaker.png"
            img_speaker.title = "Speaker icon"
            img_speaker.style.width = "20%"
            img_speaker.style.height = "20%"
            img_speaker.style.display = "initial"

            outerdiv.append(input)
            outerdiv.append(h3)
            outerdiv.append(input_checkbox)
            label_unmute.append(img_mute)
            outerdiv.append(label_unmute)
            label_mute.append(img_speaker)
            outerdiv.append(label_mute)

            document.getElementById("sliderContainer").append(outerdiv)

            $(input).bind('input', function() {
                $.getJSON("http://127.0.0.1:5001" + '/data', {
                    Name: "WindowsVolumeMixerControl",
                    Func: "setApplicationVolume",
                    Params: document.getElementById(index).value/100.0,
                    ProcessId: value.pid
                }, function(data) {
                });
                return false;
            });

            var pressed_app = false;
            // mute/unmute individual app
            $(input_checkbox).bind("change", function() {
                $.getJSON("http://127.0.0.1:5001" + '/data', {
                Name: "WindowsVolumeMixerControl",
                Func: (pressed_app ? "unmuteApplicationVolume" : "muteApplicationVolume"),
                Params: 0,
                ProcessId: value.pid
                }, function(data) {
                    if(pressed_app){
                        console.log("unmute")
                        console.log(index)
                        img_mute.style.display = "none"
                        img_speaker.style.display = "initial"
                    }
                    else{
                        console.log("mute")
                        console.log(index)
                        img_mute.style.display = "initial"
                        img_speaker.style.display = "none"
                    }
                    pressed_app = !pressed_app
                });
                return false;
            });
        }

        var pressedApp = false;
        // mute/unmute master
        $(function() {
            $('#muteUnmuteApp').bind("change", function() {
                $.getJSON("http://127.0.0.1:5001" + '/data', {
                Name: "WindowsVolumeMixerControl",
                Func: (pressedApp ? "unmuteMasterVolume" : "muteMasterVolume"),
                Params: 0,
                ProcessId: -1 //whatever
                }, function(data) {
                    pressedApp = !pressedApp
                });
                return false;
            });
        });

    </script>
    <script src="index.js"></script>
  </body>
</html>
